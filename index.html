<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ことばのトビラ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    @keyframes pop {
  0% { transform: scale(0.8); opacity: 0; }
  50% { transform: scale(1.2); opacity: 1; }
  100% { transform: scale(1); }
}

@keyframes fadein {
  0% { opacity: 0; }
  100% { opacity: 1; }
}

    body {
      font-family: "BIZ UDゴシック", "Yu Gothic", "Hiragino Kaku Gothic ProN", sans-serif;
      text-align: center;
      background: #eef;
      margin: 0;
      padding: 0;
      touch-action: manipulation;
    }
    #question {
  font-size: 2.5em;
  margin: 30px 10px 10px;
  padding: 0 10px;
  line-height: 1.5;}
    #doors {
  display: flex;
  justify-content: center;
  gap: 24px;
  flex-wrap: wrap;
  padding: 10px 20px;
}
    .option-button {
  width: 150px;
  height: 200px;
  font-size: 1.6em;
  writing-mode: vertical-rl;
  background-color: sienna;
  color: #fff9c4;
  border: 3px solid #333;
  border-radius: 12px;
  box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.4);
  cursor: pointer;
  position: relative;
  transition: transform 0.4s ease-in-out;
  transform-style: preserve-3d;
  margin: 10px;
  touch-action: manipulation;
}

    .option-button.opened {
      animation: doorOpen 0.6s forwards;
    }
    @keyframes doorOpen {
      0% { transform: rotateY(0); opacity: 1; }
      100% { transform: rotateY(90deg); opacity: 0; }
    }
    .option-button::before {
      content: "";
      position: absolute;
      width: 10px;
      height: 10px;
      background: gray;
      border-radius: 50%;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
    }
    .feedback-mark {
      position: absolute;
      font-size: 3em;
      font-weight: bold;
      transform: translate(-50%, -50%);
      z-index: 10;
      pointer-events: none;
    }
    .option-button:hover {
  transform: none; /* hoverによる回転を無効化してタブレットでの誤反応防止 */
}
    .feedback {
      font-size: 2em;
      margin-top: 20px;
      color: red;
      font-weight: bold;
    }
    #result {
      display: none;
      font-size: 1.5em;
      margin-top: 20px;
    }
    .correct-frame {
      position: absolute;
      border: 5px solid red;
      border-radius: 12px;
      pointer-events: none;
      z-index: 9;
    }
  </style>
</head>
<body>
  <h1 style="font-size: 2em;">ことばのトビラ</h1>
  <div id="question"></div>
  <div id="doors"></div>
  <div id="feedback" class="feedback"></div>
  <div id="result"></div>

  <script>
    const fullQuizData = [
  { "sentence": "かれはお金がありません。＿＿＿、がまんしました。", "options": ["だから", "でも", "それに"], "answer": "だから" },
  { "sentence": "かれはおなかがすいています。＿＿＿、パンを買いました。", "options": ["だから", "けれども", "つまり"], "answer": "だから" },
  { "sentence": "ねつがありました。＿＿＿、学校を休みました。", "options": ["だから", "また", "しかし"], "answer": "だから" },

  { "sentence": "朝に運動をはじめました。＿＿＿、けんこうになりました。", "options": ["それで", "しかし", "または"], "answer": "それで" },
  { "sentence": "道にまよいました。＿＿＿、人に道をたずねました。", "options": ["それで", "でも", "つまり"], "answer": "それで" },
  { "sentence": "雨がふりました。＿＿＿、うんどう会はちゅうしになりました。", "options": ["それで", "それとも", "たとえば"], "answer": "それで" },

  { "sentence": "雨がふっています。＿＿＿、うんどう会はちゅうしになりました。", "options": ["そのため", "だけど", "たとえば"], "answer": "そのため" },
  { "sentence": "ドアをしめました。＿＿＿、へやがしずかになりました。", "options": ["そのため", "けれども", "それとも"], "answer": "そのため" },
  { "sentence": "お金を使いすぎました。＿＿＿、貯金がへりました。", "options": ["そのため", "でも", "さて"], "answer": "そのため" },

  { "sentence": "町に車や工場がふえました。＿＿＿、町の空気がよごれてきました。", "options": ["このようなことから", "そして", "けれども"], "answer": "このようなことから" },
  { "sentence": "彼はすぐに怒るうえに、わがままだ。＿＿＿、みんなは彼をジャイアンのようだと言っている。", "options": ["このようなことから", "しかし", "なぜかというと"], "answer": "このようなことから" },
  { "sentence": "毎日ネコカフェに行ったり、町のネコの写真をとる。＿＿＿、ネコ好きだといえる。", "options": ["このようなことから", "たとえば", "でも"], "answer": "このようなことから" },

  { "sentence": "がんばって走りました。＿＿＿、ビリでした。", "options": ["しかし", "だから", "または"], "answer": "しかし" },
  { "sentence": "本気でわざを出した。＿＿＿、まったくきいていない。", "options": ["しかし", "それで", "それとも"], "answer": "しかし" },
  { "sentence": "友だちをさそいました。＿＿＿、来ませんでした。", "options": ["しかし", "だから", "さて"], "answer": "しかし" },

  { "sentence": "雨がふっていました。＿＿＿、かれは外であそびました。", "options": ["それでも", "それに", "だから"], "answer": "それでも" },
  { "sentence": "道にまよったので地図を見た。＿＿＿、まったく分からない。", "options": ["それでも", "けれども", "そして"], "answer": "それでも" },
  { "sentence": "ねつがありました。＿＿＿、学校に来ました。", "options": ["それでも", "たとえば", "だから"], "answer": "それでも" },

  { "sentence": "とてもつかれていました。＿＿＿、ちゃんとやりました。", "options": ["でも", "だから", "そして"], "answer": "でも" },
  { "sentence": "遊びたかった。＿＿＿、今日はがまんしました。", "options": ["でも", "それで", "しかも"], "answer": "でも" },
  { "sentence": "こわかった。＿＿＿、行ってみました。", "options": ["でも", "だから", "ようするに"], "answer": "でも" },

  { "sentence": "公園に行きたかったです。＿＿＿、行けませんでした。", "options": ["けれども", "そして", "だから"], "answer": "けれども" },
  { "sentence": "このゲームはむずかしい。＿＿＿、とてもおもしろい。", "options": ["けれども", "だから", "さて"], "answer": "けれども" },
  { "sentence": "がんばりました。＿＿＿、うまくできませんでした。", "options": ["けれども", "それとも", "または"], "answer": "けれども" },

  { "sentence": "友だちとけんかした。＿＿＿、きょうは一日かなしかった。", "options": ["それで", "しかし", "または"], "answer": "それで" },
  { "sentence": "道にまよいました。＿＿＿、人にたずねました。", "options": ["それで", "でも", "つまり"], "answer": "それで" },
  { "sentence": "雨がふりました。＿＿＿、うんどう会はちゅうしになりました。", "options": ["それで", "それとも", "たとえば"], "answer": "それで" },

  { "sentence": "雨がふっています。＿＿＿、うんどう会はちゅうしになりました。", "options": ["そのため", "だけど", "たとえば"], "answer": "そのため" },
  { "sentence": "ドアをしめました。＿＿＿、へやがしずかになりました。", "options": ["そのため", "けれども", "つまり"], "answer": "そのため" },
  { "sentence": "お金を使いすぎました。＿＿＿、貯金がへりました。", "options": ["そのため", "でも", "そして"], "answer": "そのため" },

  { "sentence": "がんばって走りました。＿＿＿、ビリでした。", "options": ["しかし", "だから", "または"], "answer": "しかし" },
  { "sentence": "いっしょうけんめい勉強をした。＿＿＿、100点がとれなかった。", "options": ["しかし", "それで", "それとも"], "answer": "しかし" },
  { "sentence": "友だちをさそいました。＿＿＿、来ませんでした。", "options": ["しかし", "だから", "さて"], "answer": "しかし" },

  { "sentence": "雨がふっていました。＿＿＿、かれは外であそびました。", "options": ["それでも", "それに", "だから"], "answer": "それでも" },
  { "sentence": "おこられると思いました。＿＿＿、先生はにこにこしていました。", "options": ["それでも", "だから", "そして"], "answer": "それでも" },
  { "sentence": "ねつがありました。＿＿＿、学校に来ました。", "options": ["それでも", "たとえば", "だから"], "answer": "それでも" },

  { "sentence": "とてもつかれていました。＿＿＿、ちゃんとやりました。", "options": ["でも", "だから", "そして"], "answer": "でも" },
  { "sentence": "遊びたかった。＿＿＿、今日はがまんしました。", "options": ["でも", "それで", "しかも"], "answer": "でも" },
  { "sentence": "こわかった。＿＿＿、行ってみました。", "options": ["でも", "だから", "ようするに"], "answer": "でも" },

  { "sentence": "公園に行きたかったです。＿＿＿、行けませんでした。", "options": ["けれども", "そして", "だから"], "answer": "けれども" },
  { "sentence": "手伝いたい。＿＿＿、今日はやくそくがあります。", "options": ["けれども", "だから", "さて"], "answer": "けれども" },
  { "sentence": "がんばりました。＿＿＿、うまくできませんでした。", "options": ["けれども", "それとも", "または"], "answer": "けれども" },

  { "sentence": "かれはサッカーが上手です。＿＿＿、テニスも上手です。", "options": ["しかも", "けれども", "たとえば"], "answer": "しかも" },
  { "sentence": "このふくはやすいです。＿＿＿、じょうぶです。", "options": ["しかも", "でも", "そのため"], "answer": "しかも" },
  { "sentence": "この本はかんたんです。＿＿＿、おもしろいです。", "options": ["しかも", "ようするに", "それとも"], "answer": "しかも" },

  { "sentence": "りんごを食べました。＿＿＿、バナナも食べました。", "options": ["また", "しかし", "だから"], "answer": "また" },
  { "sentence": "えをかきました。＿＿＿、うたも歌いました。", "options": ["また", "けれども", "そのため"], "answer": "また" },
  { "sentence": "はをみがきました。＿＿＿、かおもあらいました。", "options": ["また", "でも", "さて"], "answer": "また" },

  { "sentence": "朝は7時に起きました。＿＿＿、ごはんをたべました。", "options": ["そして", "それとも", "つまり"], "answer": "そして" },
  { "sentence": "せんたくをしました。＿＿＿、そうじもしました。", "options": ["そして", "たとえば", "しかし"], "answer": "そして" },
  { "sentence": "手をあらいました。＿＿＿、しょくじをしました。", "options": ["そして", "けれども", "なぜかというと"], "answer": "そして" },

  { "sentence": "おかしをもらいました。＿＿＿、ジュースももらいました。", "options": ["それに", "でも", "さて"], "answer": "それに" },
  { "sentence": "この道はひろいです。＿＿＿、新しいです。", "options": ["それに", "しかし", "または"], "answer": "それに" },
  { "sentence": "その先生はやさしいです。＿＿＿、わかりやすいです。", "options": ["それに", "けれども", "つまり"], "answer": "それに" },
  
  { "sentence": "ジュースにしますか？＿＿＿、おちゃにしますか？", "options": ["それとも", "また", "そして"], "answer": "それとも" },
  { "sentence": "おちゃにしますか？＿＿＿コーヒーにしますか？", "options": ["それとも", "だから", "たとえば"], "answer": "それとも" },
  { "sentence": "Aクラスにしますか？＿＿＿Bクラスにしますか？", "options": ["それとも", "しかも", "でも"], "answer": "それとも" },

  { "sentence": "ばんごはんはお肉かな。＿＿＿、魚かな。", "options": ["あるいは", "しかも", "たとえば"], "answer": "あるいは" },
  { "sentence": "テレビを見ます。＿＿＿、ゲームもします。", "options": ["あるいは", "このようなことから", "つまり"], "answer": "あるいは" },
  { "sentence": "電車で行く？＿＿＿、バスで行く？", "options": ["あるいは", "そして", "このようなことから"], "answer": "あるいは" },

  { "sentence": "おやつはおまんじゅうですか。＿＿＿アイスですか。", "options": ["または", "だから", "それで"], "answer": "または" },
  { "sentence": "買ってくるのはバナナですか。＿＿＿リンゴですか。", "options": ["または", "けれども", "さて"], "answer": "または" },
  { "sentence": "えんぴつで書いてください。＿＿＿ボールペンで書いても良いです。", "options": ["または", "でも", "だから"], "answer": "または" },

  { "sentence": "このケーキは小麦もたまごも入っていない。＿＿＿、アレルギーのある人も食べられる。", "options": ["つまり", "しかし", "だから"], "answer": "つまり" },
  { "sentence": "あの二人はまだ口をきかない。＿＿＿、まだ仲直りをしていないということだ。。", "options": ["つまり", "けれども", "さて"], "answer": "つまり" },
  { "sentence": "おかしを全部食べてしまった。＿＿＿、みんなが怒るということだ。", "options": ["つまり", "けれども", "たとえば"], "answer": "つまり" },

  { "sentence": "まだなれていない。＿＿＿、れんしゅうがひつようです。", "options": ["ようするに", "でも", "たとえば"], "answer": "ようするに" },
  { "sentence": "いつもねぼうしてしまいます。＿＿＿、毎日ちこくです。", "options": ["ようするに", "しかし", "さて"], "answer": "ようするに" },
  { "sentence": "テスト前に何もしていない。＿＿＿、じゅんびぶそくだ。", "options": ["ようするに", "しかし", "だから"], "answer": "ようするに" },

  { "sentence": "雨の日のじゅんびをしましょう。＿＿＿、かさ、長ぐつ、カッパなどです。", "options": ["たとえば", "しかし", "それでも"], "answer": "たとえば" },
  { "sentence": "いろいろなくだものがあります。＿＿＿、リンゴやバナナなどです。", "options": ["たとえば", "だから", "それに"], "answer": "たとえば" },
  { "sentence": "王様とよばれる動物がいます。＿＿＿、ライオンです。", "options": ["たとえば", "けれども", "それで"], "answer": "たとえば" },

  { "sentence": "今日は学校をやすみました。＿＿＿、びょうきでした。", "options": ["なぜかというと", "だから", "さて"], "answer": "なぜかというと" },
  { "sentence": "犬が好きです。＿＿＿、かわいくて、なついてくれるからです。。", "options": ["なぜかというと", "しかも", "さて"], "answer": "なぜかというと" },
  { "sentence": "友だちは来ませんでした。＿＿＿、びょうきだったからです。", "options": ["なぜかというと", "それに", "でも"], "answer": "なぜかというと" },

  { "sentence": "みんな来ました。＿＿＿、はじめましょう。", "options": ["では", "それに", "けれども"], "answer": "では" },
  { "sentence": "プリントが終わりましたね。＿＿＿、つぎにドリルをしましょう。", "options": ["では", "けれども", "たとえば"], "answer": "では" },
  { "sentence": "チャイムが鳴りました。＿＿＿、教室にもどりましょう。", "options": ["では", "だけど", "しかも"], "answer": "では" },

  { "sentence": "このはなしはここまでです。＿＿＿、つぎのはなしをしましょう。", "options": ["さて", "また", "ようするに"], "answer": "さて" },
  { "sentence": "今日はかけ算について学習しました。＿＿＿、しつもんはありますか？", "options": ["さて", "または", "そのため"], "answer": "さて" },
  { "sentence": "みなさん、きょうもよくできました。＿＿＿、この問題はとけますか？", "options": ["さて", "なぜかというと", "でも"], "answer": "さて" },

  { "sentence": "映画はおもしろかったね。＿＿＿、宿題はもう終わったかな。", "options": ["ところで", "つまり", "でも"], "answer": "ところで" },
  { "sentence": "料理がとくいなんだ。＿＿＿、きみの好きなことってなに。", "options": ["ところで", "または", "だから"], "answer": "ところで" },
  { "sentence": "テストはむずかしかったね。＿＿＿、次のテストはいつですか。", "options": ["ところで", "だけど", "それとも"], "answer": "ところで" },


];


    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function getQuizSequence(data, count) {
      return shuffle([...data]).slice(0, count);
    }

    const quizData = shuffle([...fullQuizData]).slice(0, 10);
    let current = 0;
    let quizStartTime; // ← クイズ全体の開始時間を記録
    let correctCount = 0;
    let solveTimes = []; 
    let playerAnswers = [];
    const questionBox = document.getElementById("question");
    const doorsBox = document.getElementById("doors");
    const feedbackBox = document.getElementById("feedback");
    const resultBox = document.getElementById("result");   
    let startTime;           


    function loadQuestion() {
      if (current === 0) quizStartTime = Date.now(); // ← 初回だけ全体の開始時間を記録
      startTime = Date.now();
      const quiz = quizData[current];
      questionBox.textContent = `(${current + 1}/${quizData.length}) ${quiz.sentence}`;
      doorsBox.innerHTML = "";
      feedbackBox.textContent = "";

      const shuffledOptions = [...quiz.options];
      for (let i = shuffledOptions.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffledOptions[i], shuffledOptions[j]] = [shuffledOptions[j], shuffledOptions[i]];
      }

      shuffledOptions.forEach(option => {
        const button = document.createElement("button");
        button.className = "option-button";
        button.textContent = option;
        button.onclick = () => choose(button, option, quiz.answer);
        doorsBox.appendChild(button);
      });
    }

    function choose(button, selected, correct) {
      const isCorrect = selected === correct;
      if (isCorrect) correctCount++;
      playerAnswers.push({
  sentence: quizData[current].sentence,
  selected: selected,
  correct: correct,
  isCorrect: isCorrect
});


      const buttons = document.querySelectorAll(".option-button");
      buttons.forEach(btn => btn.disabled = true);

      button.classList.add("opened");
       const endTime = performance.now();
       const timeTaken = (endTime - startTime) / 1000; // 秒に変換
       solveTimes.push(timeTaken);
button.addEventListener("animationend", () => {
  const mark = document.createElement("div");
  mark.textContent = isCorrect ? "○" : "×";
  mark.className = "feedback-mark";
  mark.style.color = isCorrect ? "green" : "red";
  mark.style.left = button.offsetLeft + button.offsetWidth / 2 + "px";
  mark.style.top = button.offsetTop + button.offsetHeight / 2 + "px";
  doorsBox.appendChild(mark);

  if (isCorrect) {
    setTimeout(nextStep, 1000);
  } else {
    feedbackBox.textContent = "正解は…";
    setTimeout(() => {
      feedbackBox.textContent = "";
      buttons.forEach(btn => {
        if (btn.textContent === correct) {
          const frame = document.createElement("div");
          frame.className = "correct-frame";
          frame.style.width = btn.offsetWidth + "px";
          frame.style.height = btn.offsetHeight + "px";
          frame.style.left = btn.offsetLeft + "px";
          frame.style.top = btn.offsetTop + "px";
          doorsBox.appendChild(frame);
        }
      });
      setTimeout(nextStep, 2000);
    }, 2000);
  }
}, { once: true });

      
    }

    function nextStep() {
      current++;
      if (current < quizData.length) {
        loadQuestion();
      } 
      else {
  questionBox.textContent = "";
  doorsBox.innerHTML = "";
  feedbackBox.textContent = "";

  let message = "";
if (correctCount >= 9) {
  message = "🌟すばらしい！ことば名人！🌟";
  resultBox.style.color = "gold";
  resultBox.style.fontSize = "2.5em";
  resultBox.style.animation = "pop 1s ease";
  document.body.style.backgroundColor = "#fffbe7";
} else if (correctCount >= 6) {
  message = "😊よくできました！😊";
  resultBox.style.color = "dodgerblue";
  resultBox.style.fontSize = "2.2em";
  resultBox.style.animation = "fadein 1s ease";
  document.body.style.backgroundColor = "#eef";
} else if (correctCount >= 3) {
  message = "😌もうすこし！がんばろう";
  resultBox.style.color = "gray";
  resultBox.style.fontSize = "2em";
  resultBox.style.animation = "fadein 1s ease";
  document.body.style.backgroundColor = "#eef";
} else {
  message = "💡つぎはもっとできるよ！";
  resultBox.style.color = "darkgray";
  resultBox.style.fontSize = "1.8em";
  resultBox.style.animation = "fadein 1s ease";
  document.body.style.backgroundColor = "#eef";
}

resultBox.innerHTML = `
  おしまい！<br>
  正解数：${correctCount} / ${quizData.length}<br><br>
  ${message}<br><br>
  <button id="retryButton" style="
    margin-top: 10px;
    padding: 8px 16px;
    font-size: 1em;
    cursor: pointer;
    border-radius: 6px;
    border: 1px solid #999;
    background-color: white;
  ">もういちど遊ぶ</button>
`;
resultBox.style.display = "block";

document.getElementById("retryButton").onclick = () => {
  current = 0;
  correctCount = 0;
  playerAnswers = [];
  quizData.splice(0, quizData.length, ...shuffle([...fullQuizData]).slice(0, 10));

  resultBox.innerHTML = "";
  resultBox.style.display = "none";
  document.body.style.backgroundColor = "#eef";

  loadQuestion();
};

  const table = document.createElement("table");
  table.style.margin = "20px auto";
  table.style.borderCollapse = "collapse";
  table.style.width = "90%";
  table.style.maxWidth = "800px";
  table.style.fontSize = "1em";
  const header = document.createElement("tr");
  ["No", "問題文", "あなたの答え", "正解", "○×"].forEach(text => {
    const th = document.createElement("th");
    th.textContent = text;
    th.style.border = "1px solid #999";
    th.style.padding = "8px";
    th.style.background = "#f0f0f0";
    header.appendChild(th);
  });
  table.appendChild(header);

  playerAnswers.forEach((item, index) => {
    const row = document.createElement("tr");

    const cells = [
      index + 1,
      item.sentence.replace("＿＿＿", "____"),
      item.selected,
      item.correct,
      item.isCorrect ? "⭕" : "❌"
    ];

    cells.forEach(text => {
      const td = document.createElement("td");
      td.textContent = text;
      td.style.border = "1px solid #999";
      td.style.padding = "6px";
      td.style.textAlign = "center";
      row.appendChild(td);
    
    });

  table.appendChild(row);
  });

      resultBox.appendChild(table);

  

  } // ← nextStep() の閉じカッコ
    }
  window.onload = loadQuestion;
</script>
</body>
</html>
